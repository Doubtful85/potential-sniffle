{"id":"google/cloud/spanner/transaction","name":"Transaction","title":["Google","Cloud","Spanner","Transaction"],"description":"<h1 id=\"transaction\">Transaction</h1>\n\n<p>A transaction in Cloud Spanner is a set of reads and writes that execute\natomically at a single logical point in time across columns, rows, and\ntables in a database.</p>\n\n<p>All changes are accumulated in memory until the block passed to\n<a data-custom-type=\"google/cloud/spanner/client\" data-method=\"transaction-instance\">Client#transaction</a> completes. Transactions will be automatically\nretried when possible. See <a data-custom-type=\"google/cloud/spanner/client\" data-method=\"transaction-instance\">Client#transaction</a>.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L76","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  # Read the second album budget.\n  second_album_result = tx.read \"Albums\", [\"marketing_budget\"],\n                                keys: [[2, 2]], limit: 1\n  second_album_row = second_album_result.rows.first\n  second_album_budget = second_album_row.values.first\n\n  transfer_amount = 200000\n\n  if second_album_budget < 300000\n    # Raising an exception will automatically roll back the\n    # transaction.\n    raise \"The second album doesn't have enough funds to transfer\"\n  end\n\n  # Read the first album's budget.\n  first_album_result = tx.read \"Albums\", [\"marketing_budget\"],\n                                keys: [[1, 1]], limit: 1\n  first_album_row = first_album_result.rows.first\n  first_album_budget = first_album_row.values.first\n\n  # Update the budgets.\n  second_album_budget -= transfer_amount\n  first_album_budget += transfer_amount\n  puts \"Setting first album's budget to #{first_album_budget} and \" \\\n       \"the second album's budget to #{second_album_budget}.\"\n\n  # Update the rows.\n  rows = [\n    {singer_id: 1, album_id: 1, marketing_budget: first_album_budget},\n    {singer_id: 2, album_id: 2, marketing_budget: second_album_budget}\n  ]\n  tx.update \"Albums\", rows\nend"}],"methods":[{"id":"initialize-constructor","type":"constructor","name":"initialize","title":["Google","Cloud","Spanner","Transaction#initialize"],"description":"","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L80","resources":[],"examples":[],"params":[],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"google/cloud/spanner/transaction\">Transaction</a>"],"description":"a new instance of Transaction"}]},{"id":"transaction_id-instance","type":"instance","name":"transaction_id","title":["Google","Cloud","Spanner","Transaction#transaction_id"],"description":"<p>Identifier of the transaction results were run in.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L87","resources":[],"examples":[],"params":[],"exceptions":[],"returns":[{"types":["String"],"description":"The transaction id."}]},{"id":"execute-instance","type":"instance","name":"execute","title":["Google","Cloud","Spanner","Transaction#execute"],"description":"<p>Executes a SQL query.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L245","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  results = tx.execute \"SELECT * FROM users\"\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\n  end\nend"},{"caption":"<p>Query using query parameters:</p>","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  results = tx.execute \"SELECT * FROM users WHERE active = @active\",\n                       params: { active: true }\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\n  end\nend"},{"caption":"<p>Query with a SQL STRUCT query parameter as a Hash:</p>","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  user_hash = { id: 1, name: \"Charlie\", active: false }\n\n  results = tx.execute \"SELECT * FROM users WHERE \" \\\n                       \"ID = @user_struct.id \" \\\n                       \"AND name = @user_struct.name \" \\\n                       \"AND active = @user_struct.active\",\n                       params: { user_struct: user_hash }\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\n  end\nend"},{"caption":"<p>Specify the SQL STRUCT type using Fields object:</p>","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  user_type = tx.fields id: :INT64, name: :STRING, active: :BOOL\n  user_hash = { id: 1, name: nil, active: false }\n\n  results = tx.execute \"SELECT * FROM users WHERE \" \\\n                       \"ID = @user_struct.id \" \\\n                       \"AND name = @user_struct.name \" \\\n                       \"AND active = @user_struct.active\",\n                       params: { user_struct: user_hash },\n                       types: { user_struct: user_type }\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\n  end\nend"},{"caption":"<p>Or, query with a SQL STRUCT as a typed Data object:</p>","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  user_type = tx.fields id: :INT64, name: :STRING, active: :BOOL\n  user_data = user_type.struct id: 1, name: nil, active: false\n\n  results = tx.execute \"SELECT * FROM users WHERE \" \\\n                       \"ID = @user_struct.id \" \\\n                       \"AND name = @user_struct.name \" \\\n                       \"AND active = @user_struct.active\",\n                       params: { user_struct: user_data }\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\n  end\nend"}],"params":[{"name":"sql","types":["String"],"description":"The SQL query string. See <a href=\"https://cloud.google.com/spanner/docs/query-syntax\">Query\nsyntax</a>.</p>\n\n<p>The SQL query string can contain parameter placeholders. A parameter\nplaceholder consists of “@” followed by the parameter name.\nParameter names consist of any combination of letters, numbers, and\nunderscores.","optional":false,"nullable":false},{"name":"params","types":["Hash"],"description":"SQL parameters for the query string. The\nparameter placeholders, minus the “@”, are the the hash keys, and\nthe literal values are the hash values. If the query string contains\nsomething like “WHERE id &gt; @msg_id”, then the params must contain\nsomething like <code>:msg_id =&gt; 1</code>.</p>\n\n<p>Ruby types are mapped to Spanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n    <tr>\n      <td><code>STRUCT</code></td>\n      <td><code>Hash</code>, <a data-custom-type=\"google/cloud/spanner/data\">Data</a></td>\n      <td> </td>\n    </tr>\n  </tbody>\n</table>\n\n<p>See <a href=\"https://cloud.google.com/spanner/docs/data-definition-language#data_types\">Data\ntypes</a>.</p>\n\n<p>See <a href=\"https://cloud.google.com/spanner/docs/data-types#constructing-a-struct\">Data Types - Constructing a\nSTRUCT</a>.","optional":true,"default":"nil","nullable":true},{"name":"types","types":["Hash"],"description":"Types of the SQL parameters in <code>params</code>. It is not\nalways possible for Cloud Spanner to infer the right SQL type from a\nvalue in <code>params</code>. In these cases, the <code>types</code> hash must be used to\nspecify the SQL type for these values.</p>\n\n<p>The keys of the hash should be query string parameter placeholders,\nminus the “@”. The values of the hash should be Cloud Spanner type\ncodes from the following list:</p>\n\n<ul>\n  <li><code>:BOOL</code></li>\n  <li><code>:BYTES</code></li>\n  <li><code>:DATE</code></li>\n  <li><code>:FLOAT64</code></li>\n  <li><code>:INT64</code></li>\n  <li><code>:STRING</code></li>\n  <li><code>:TIMESTAMP</code></li>\n  <li><code>Array</code> - Lists are specified by providing the type code in an\narray. For example, an array of integers are specified as\n<code>[:INT64]</code>.</li>\n  <li><a data-custom-type=\"google/cloud/spanner/fields\">Fields</a> - Types for STRUCT values (<code>Hash</code>/<a data-custom-type=\"google/cloud/spanner/data\">Data</a> objects) are\nspecified using a <a data-custom-type=\"google/cloud/spanner/fields\">Fields</a> object.</li>\n</ul>\n\n<p>Types are optional.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"google/cloud/spanner/results\">Google::Cloud::Spanner::Results</a>"],"description":"The results of the query\nexecution."}]},{"id":"read-instance","type":"instance","name":"read","title":["Google","Cloud","Spanner","Transaction#read"],"description":"<p>Read rows from a database table, as a simple alternative to\n<a data-custom-type=\"google/cloud/spanner/transaction\" data-method=\"execute-instance\">#execute</a>.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L289","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  results = tx.read \"users\", [:id, :name]\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\n  end\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nread.","optional":false,"nullable":false},{"name":"columns","types":["Array<String, Symbol>"],"description":"The columns of table to be\nreturned for each row matching this request.","optional":false,"nullable":false},{"name":"keys","types":["Object","Array<Object>"],"description":"A single, or list of keys or key\nranges to match returned data to. Values should have exactly as many\nelements as there are columns in the primary key.","optional":true,"default":"nil","nullable":true},{"name":"index","types":["String"],"description":"The name of an index to use instead of the\ntable’s primary key when interpreting <code>id</code> and sorting result rows.\nOptional.","optional":true,"default":"nil","nullable":true},{"name":"limit","types":["Integer"],"description":"If greater than zero, no more than this number\nof rows will be returned. The default is no limit.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"google/cloud/spanner/results\">Google::Cloud::Spanner::Results</a>"],"description":"The results of the read\noperation."}]},{"id":"upsert-instance","type":"instance","name":"upsert","title":["Google","Cloud","Spanner","Transaction#upsert"],"description":"<p>Inserts or updates rows in a table. If any of the rows already exist,\nthen its column values are overwritten with the ones provided. Any\ncolumn values not explicitly written are preserved.</p>\n\n<p>All changes are accumulated in memory until the block passed to\n<a data-custom-type=\"google/cloud/spanner/client\" data-method=\"transaction-instance\">Client#transaction</a> completes.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L340","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.upsert \"users\", [{ id: 1, name: \"Charlie\", active: false },\n                      { id: 2, name: \"Harvey\",  active: true }]\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"rows","types":["Array<Hash>"],"description":"One or more hash objects with the hash keys\nmatching the table’s columns, and the hash values matching the\ntable’s values.</p>\n\n<p>Ruby types are mapped to Spanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>See <a href=\"https://cloud.google.com/spanner/docs/data-definition-language#data_types\">Data\ntypes</a>.","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"insert-instance","type":"instance","name":"insert","title":["Google","Cloud","Spanner","Transaction#insert"],"description":"<p>Inserts new rows in a table. If any of the rows already exist, the\nwrite or request fails with error Google::Cloud::AlreadyExistsError.</p>\n\n<p>All changes are accumulated in memory until the block passed to\n<a data-custom-type=\"google/cloud/spanner/client\" data-method=\"transaction-instance\">Client#transaction</a> completes.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L386","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.insert \"users\", [{ id: 1, name: \"Charlie\", active: false },\n                      { id: 2, name: \"Harvey\",  active: true }]\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"rows","types":["Array<Hash>"],"description":"One or more hash objects with the hash keys\nmatching the table’s columns, and the hash values matching the\ntable’s values.</p>\n\n<p>Ruby types are mapped to Spanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>See <a href=\"https://cloud.google.com/spanner/docs/data-definition-language#data_types\">Data\ntypes</a>.","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"update-instance","type":"instance","name":"update","title":["Google","Cloud","Spanner","Transaction#update"],"description":"<p>Updates existing rows in a table. If any of the rows does not already\nexist, the request fails with error Google::Cloud::NotFoundError.</p>\n\n<p>All changes are accumulated in memory until the block passed to\n<a data-custom-type=\"google/cloud/spanner/client\" data-method=\"transaction-instance\">Client#transaction</a> completes.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L431","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.update \"users\", [{ id: 1, name: \"Charlie\", active: false },\n                      { id: 2, name: \"Harvey\",  active: true }]\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"rows","types":["Array<Hash>"],"description":"One or more hash objects with the hash keys\nmatching the table’s columns, and the hash values matching the\ntable’s values.</p>\n\n<p>Ruby types are mapped to Spanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>See <a href=\"https://cloud.google.com/spanner/docs/data-definition-language#data_types\">Data\ntypes</a>.","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"replace-instance","type":"instance","name":"replace","title":["Google","Cloud","Spanner","Transaction#replace"],"description":"<p>Inserts or replaces rows in a table. If any of the rows already exist,\nit is deleted, and the column values provided are inserted instead.\nUnlike #upsert, this means any values not explicitly written become\n<code>NULL</code>.</p>\n\n<p>All changes are accumulated in memory until the block passed to\n<a data-custom-type=\"google/cloud/spanner/client\" data-method=\"transaction-instance\">Client#transaction</a> completes.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L478","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.replace \"users\", [{ id: 1, name: \"Charlie\", active: false },\n                       { id: 2, name: \"Harvey\",  active: true }]\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"rows","types":["Array<Hash>"],"description":"One or more hash objects with the hash keys\nmatching the table’s columns, and the hash values matching the\ntable’s values.</p>\n\n<p>Ruby types are mapped to Spanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>See <a href=\"https://cloud.google.com/spanner/docs/data-definition-language#data_types\">Data\ntypes</a>.","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"delete-instance","type":"instance","name":"delete","title":["Google","Cloud","Spanner","Transaction#delete"],"description":"<p>Deletes rows from a table. Succeeds whether or not the specified rows\nwere present.</p>\n\n<p>All changes are accumulated in memory until the block passed to\n<a data-custom-type=\"google/cloud/spanner/client\" data-method=\"transaction-instance\">Client#transaction</a> completes.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L504","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction { |tx| tx.delete \"users\", [1, 2, 3] }"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"keys","types":["Object","Array<Object>"],"description":"A single, or list of keys or key\nranges to match returned data to. Values should have exactly as many\nelements as there are columns in the primary key.","optional":true,"default":"[]","nullable":false}],"exceptions":[],"returns":[]},{"id":"fields-instance","type":"instance","name":"fields","title":["Google","Cloud","Spanner","Transaction#fields"],"description":"<p>Creates a configuration object (<a data-custom-type=\"google/cloud/spanner/fields\">Fields</a>) that may be provided to\nqueries or used to create STRUCT objects. (The STRUCT will be\nrepresented by the <a data-custom-type=\"google/cloud/spanner/data\">Data</a> class.) See <a data-custom-type=\"google/cloud/spanner/client\" data-method=\"execute-instance\">Client#execute</a> and/or\n<a data-custom-type=\"google/cloud/spanner/fields\" data-method=\"struct-instance\">Fields#struct</a>.</p>\n\n<p>For more information, see <a href=\"https://cloud.google.com/spanner/docs/data-types#constructing-a-struct\">Data Types - Constructing a\nSTRUCT</a>.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L607","resources":[],"examples":[{"caption":"<p>Create a STRUCT value with named fields using Fields object:</p>","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  named_type = tx.fields(\n    { id: :INT64, name: :STRING, active: :BOOL }\n  )\n  named_data = named_type.struct(\n    { id: 42, name: nil, active: false }\n  )\nend"},{"caption":"<p>Create a STRUCT value with anonymous field names:</p>","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  anon_type = tx.fields [:INT64, :STRING, :BOOL]\n  anon_data = anon_type.struct [42, nil, false]\nend"},{"caption":"<p>Create a STRUCT value with duplicate field names:</p>","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  dup_type = tx.fields [[:x, :INT64], [:x, :STRING], [:x, :BOOL]]\n  dup_data = dup_type.struct [42, nil, false]\nend"}],"params":[{"name":"types","types":["Array","Hash"],"description":"Accepts an array or hash types.</p>\n\n<p>Arrays can contain just the type value, or a sub-array of the\nfield’s name and type value. Hash keys must contain the field name\nas a <code>Symbol</code> or <code>String</code>, or the field position as an <code>Integer</code>.\nHash values must contain the type value. If a Hash is used the\nfields will be created using the same order as the Hash keys.</p>\n\n<p>Supported type values incude:</p>\n\n<ul>\n  <li><code>:BOOL</code></li>\n  <li><code>:BYTES</code></li>\n  <li><code>:DATE</code></li>\n  <li><code>:FLOAT64</code></li>\n  <li><code>:INT64</code></li>\n  <li><code>:STRING</code></li>\n  <li><code>:TIMESTAMP</code></li>\n  <li><code>Array</code> - Lists are specified by providing the type code in an\narray. For example, an array of integers are specified as\n<code>[:INT64]</code>.</li>\n  <li><a data-custom-type=\"google/cloud/spanner/fields\">Fields</a> - Nested Structs are specified by providing a Fields\nobject.</li>\n</ul>","optional":false,"nullable":false}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"google/cloud/spanner/fields\">Fields</a>"],"description":"The fields of the given types."}]},{"id":"range-instance","type":"instance","name":"range","title":["Google","Cloud","Spanner","Transaction#range"],"description":"<p>Creates a Cloud Spanner Range. This can be used in place of a Ruby\nRange when needing to exclude the beginning value.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L640","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  key_range = tx.range 1, 100\n  results = tx.read \"users\", [:id, :name], keys: key_range\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\n  end\nend"}],"params":[{"name":"beginning","types":["Object"],"description":"The object that defines the beginning of the\nrange.","optional":false,"nullable":false},{"name":"ending","types":["Object"],"description":"The object that defines the end of the range.","optional":false,"nullable":false},{"name":"exclude_begin","types":["Boolean"],"description":"Determines if the range excludes its\nbeginning value. Default is <code>false</code>.","optional":true,"default":"false","nullable":false},{"name":"exclude_end","types":["Boolean"],"description":"Determines if the range excludes its\nending value. Default is <code>false</code>.","optional":true,"default":"false","nullable":false}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"google/cloud/spanner/range\">Google::Cloud::Spanner::Range</a>"],"description":"The new Range instance."}]},{"id":"commit_timestamp-instance","type":"instance","name":"commit_timestamp","title":["Google","Cloud","Spanner","Transaction#commit_timestamp"],"description":"<p>Creates a column value object representing setting a field’s value to\nthe timestamp of the commit. (See <a data-custom-type=\"google/cloud/spanner/client\" data-method=\"commit_timestamp-instance\">Client#commit_timestamp</a>)</p>\n\n<p>This placeholder value can only be used for timestamp columns that\nhave set the option “(allow_commit_timestamp=true)” in the schema.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L668","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\n\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.insert \"users\", [\n    { id: 5, name: \"Murphy\", updated_at: tx.commit_timestamp }\n  ]\nend"}],"params":[],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"google/cloud/spanner/columnvalue\">ColumnValue</a>"],"description":"The commit timestamp column value object."}]}]}